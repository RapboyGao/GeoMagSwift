<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="520" viewBox="0 0 1200 520" role="img" aria-labelledby="title desc">
  <title id="title">GeoMagSwift Computation Flow</title>
  <desc id="desc">From input date and coordinates to interpolated coefficients, spherical harmonics synthesis, and magnetic field outputs with secular variation.</desc>
  <defs>
    <style>
      .bg { fill: #f8fafc; }
      .box { fill: #ffffff; stroke: #0f172a; stroke-width: 2; rx: 12; ry: 12; }
      .title { font: 700 20px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #0f172a; }
      .text { font: 500 16px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #1e293b; }
      .sub { font: 400 14px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #334155; }
      .line { stroke: #0f172a; stroke-width: 2.5; fill: none; }
      .accent { fill: #dbeafe; stroke: #1d4ed8; stroke-width: 2; }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0f172a" />
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="1200" height="520" />
  <text class="title" x="40" y="42">GeoMagSwift Magnetic Field Computation Flow</text>

  <rect class="box" x="40" y="80" width="220" height="120" />
  <text class="text" x="62" y="115">Input</text>
  <text class="sub" x="62" y="145">- Date</text>
  <text class="sub" x="62" y="168">- Latitude / Longitude</text>
  <text class="sub" x="62" y="191">- Altitude (km)</text>

  <rect class="box" x="320" y="80" width="260" height="120" />
  <text class="text" x="342" y="115">Model Selection</text>
  <text class="sub" x="342" y="145">SHCModel.bestModel(for: date)</text>
  <text class="sub" x="342" y="168">or specified model</text>

  <rect class="box" x="640" y="80" width="250" height="120" />
  <text class="text" x="662" y="115">Date Normalization</text>
  <text class="sub" x="662" y="145">Date -> Decimal Year</text>
  <text class="sub" x="662" y="168">DateUtils.decimalYear</text>

  <rect class="box" x="940" y="80" width="220" height="120" />
  <text class="text" x="962" y="115">Epoch Interpolation</text>
  <text class="sub" x="962" y="145">Interpolate g/h</text>
  <text class="sub" x="962" y="168">Compute gDot/hDot</text>

  <rect class="box accent" x="230" y="280" width="300" height="140" />
  <text class="text" x="252" y="315">Spherical Harmonics</text>
  <text class="sub" x="252" y="345">fieldComponents(nmax, g, h, ...)</text>
  <text class="sub" x="252" y="368">-> Main field (X, Y, Z)</text>

  <rect class="box accent" x="640" y="280" width="300" height="140" />
  <text class="text" x="662" y="315">Secular Variation</text>
  <text class="sub" x="662" y="345">fieldComponents(nmax, gDot, hDot, ...)</text>
  <text class="sub" x="662" y="368">-> Derivatives per year</text>

  <rect class="box" x="980" y="280" width="180" height="140" />
  <text class="text" x="1002" y="315">Output</text>
  <text class="sub" x="1002" y="345">MagneticFieldSolution</text>
  <text class="sub" x="1002" y="368">mainField +</text>
  <text class="sub" x="1002" y="391">secularVariation</text>

  <path class="line" d="M260 140 L320 140" marker-end="url(#arrow)" />
  <path class="line" d="M580 140 L640 140" marker-end="url(#arrow)" />
  <path class="line" d="M890 140 L940 140" marker-end="url(#arrow)" />

  <path class="line" d="M1050 200 L1050 260 L530 260 L530 310" marker-end="url(#arrow)" />
  <path class="line" d="M530 350 L640 350" marker-end="url(#arrow)" />
  <path class="line" d="M940 350 L980 350" marker-end="url(#arrow)" />
</svg>
