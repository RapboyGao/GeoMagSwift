<svg xmlns="http://www.w3.org/2000/svg" width="980" height="1960" viewBox="0 0 980 1960" role="img" aria-labelledby="title desc">
  <title id="title">GeoMagSwift Mathematical Computation Flow (Vertical, LaTeX-style)</title>
  <desc id="desc">Vertical mathematical flow using LaTeX-like typography from interpolation to potential, gradient, derived quantities, and final result.</desc>

  <defs>
    <style>
      .bg { fill: #f8fafc; }
      .box { fill: #ffffff; stroke: #0f172a; stroke-width: 2; rx: 14; ry: 14; }
      .em { fill: #ecfeff; stroke: #0e7490; stroke-width: 2; rx: 14; ry: 14; }
      .title { font: 700 28px "Times New Roman", Times, serif; fill: #0f172a; }
      .h { font: 700 22px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #0f172a; }
      .t { font: 500 17px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #1e293b; }
      .m { font: 500 34px "Times New Roman", Times, serif; fill: #111827; }
      .line { stroke: #0f172a; stroke-width: 3; fill: none; }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0f172a" />
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="980" height="1960"/>
  <text class="title" x="36" y="54">GeoMagSwift Detailed Mathematical Flow (Vertical)</text>

  <rect class="box" x="70" y="90" width="840" height="140"/>
  <text class="h" x="100" y="134">1) Date to Decimal Year</text>
  <text class="m" x="100" y="186">t = decimalYear(date)</text>

  <path class="line" d="M490 230 L490 275" marker-end="url(#arrow)"/>

  <rect class="box" x="70" y="285" width="840" height="250"/>
  <text class="h" x="100" y="330">2) Epoch Bracketing and Interpolation</text>
  <text class="m" x="100" y="382">frac = (t − t<tspan baseline-shift="sub" font-size="20">0</tspan>)/(t<tspan baseline-shift="sub" font-size="20">1</tspan> − t<tspan baseline-shift="sub" font-size="20">0</tspan>)</text>
  <text class="m" x="100" y="430">g(t)=g<tspan baseline-shift="sub" font-size="20">0</tspan> + (g<tspan baseline-shift="sub" font-size="20">1</tspan>−g<tspan baseline-shift="sub" font-size="20">0</tspan>) frac</text>
  <text class="m" x="100" y="478">h(t)=h<tspan baseline-shift="sub" font-size="20">0</tspan> + (h<tspan baseline-shift="sub" font-size="20">1</tspan>−h<tspan baseline-shift="sub" font-size="20">0</tspan>) frac</text>
  <text class="m" x="100" y="526">ġ,ḣ from finite differences between epochs</text>

  <path class="line" d="M490 535 L490 580" marker-end="url(#arrow)"/>

  <rect class="box" x="70" y="590" width="840" height="280"/>
  <text class="h" x="100" y="634">3) Magnetic Scalar Potential</text>
  <text class="m" x="100" y="686">V(r, θ, λ)=a Σ<tspan baseline-shift="super" font-size="20">N</tspan><tspan baseline-shift="sub" font-size="18">n=1</tspan>(a/r)<tspan baseline-shift="super" font-size="20">n+1</tspan></text>
  <text class="m" x="100" y="736">× Σ<tspan baseline-shift="super" font-size="20">n</tspan><tspan baseline-shift="sub" font-size="18">m=0</tspan>[g<tspan baseline-shift="sub" font-size="18">nm</tspan>cos(mλ)+h<tspan baseline-shift="sub" font-size="18">nm</tspan>sin(mλ)]</text>
  <text class="m" x="100" y="786">× P<tspan baseline-shift="sub" font-size="18">n,m</tspan>(cos θ)</text>

  <path class="line" d="M490 870 L490 915" marker-end="url(#arrow)"/>

  <rect class="em" x="70" y="925" width="840" height="170"/>
  <text class="h" x="100" y="970">4) Main Field Components</text>
  <text class="m" x="100" y="1022">B = −∇V</text>
  <text class="m" x="100" y="1070">X = B<tspan baseline-shift="sub" font-size="20">N</tspan>, Y = B<tspan baseline-shift="sub" font-size="20">E</tspan>, Z = B<tspan baseline-shift="sub" font-size="20">D</tspan></text>

  <path class="line" d="M490 1095 L490 1140" marker-end="url(#arrow)"/>

  <rect class="em" x="70" y="1150" width="840" height="190"/>
  <text class="h" x="100" y="1195">5) Derived Quantities</text>
  <text class="m" x="100" y="1245">H = √(X<tspan baseline-shift="super" font-size="20">2</tspan> + Y<tspan baseline-shift="super" font-size="20">2</tspan>)</text>
  <text class="m" x="100" y="1293">F = √(H<tspan baseline-shift="super" font-size="20">2</tspan> + Z<tspan baseline-shift="super" font-size="20">2</tspan>)</text>
  <text class="m" x="100" y="1337">D = atan2(Y, X), I = atan2(Z, H)</text>

  <path class="line" d="M490 1340 L490 1385" marker-end="url(#arrow)"/>

  <rect class="box" x="70" y="1395" width="840" height="170"/>
  <text class="h" x="100" y="1440">6) Secular Variation</text>
  <text class="m" x="100" y="1490">(Ẋ, Ẏ, Ż) = fieldComponents(n<tspan baseline-shift="sub" font-size="20">max</tspan>, ġ, ḣ, ...)</text>
  <text class="m" x="100" y="1538">(Ḣ, Ḟ, Ḋ, İ) by propagation</text>

  <path class="line" d="M490 1565 L490 1610" marker-end="url(#arrow)"/>

  <rect class="box" x="70" y="1620" width="840" height="260"/>
  <text class="h" x="100" y="1665">7) Final Result</text>
  <text class="m" x="100" y="1715">MagneticFieldSolution = {</text>
  <text class="m" x="100" y="1763">mainField: (X, Y, Z, H, F, D, I),</text>
  <text class="m" x="100" y="1811">secularVariation: (Ẋ, Ẏ, Ż, Ḣ, Ḟ, Ḋ, İ)</text>
  <text class="m" x="100" y="1859">}</text>
</svg>
