<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="780" viewBox="0 0 1400 780" role="img" aria-labelledby="title desc">
  <title id="title">GeoMagSwift Mathematical Computation Flow (LaTeX-style)</title>
  <desc id="desc">Detailed mathematical flow using LaTeX-like typography for interpolation, potential, gradient, field components, derived quantities, and secular variation.</desc>

  <defs>
    <style>
      .bg { fill: #f8fafc; }
      .box { fill: #ffffff; stroke: #0f172a; stroke-width: 2; rx: 12; ry: 12; }
      .em { fill: #ecfeff; stroke: #0e7490; stroke-width: 2; rx: 12; ry: 12; }
      .title { font: 700 24px "Times New Roman", Times, serif; fill: #0f172a; }
      .h { font: 700 17px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #0f172a; }
      .t { font: 500 14px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; fill: #1e293b; }
      .m { font: 500 30px "Times New Roman", Times, serif; fill: #111827; }
      .line { stroke: #0f172a; stroke-width: 2.4; fill: none; }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0f172a" />
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="1400" height="780" />
  <text class="title" x="34" y="44">GeoMagSwift Detailed Mathematical Flow (LaTeX-style)</text>

  <rect class="box" x="30" y="84" width="300" height="130" />
  <text class="h" x="50" y="116">1) Date to Decimal Year</text>
  <text class="t" x="50" y="144">Input: date, latitude, longitude, altitude</text>
  <text class="m" x="50" y="182">t = decimalYear(date)</text>

  <rect class="box" x="370" y="84" width="340" height="190" />
  <text class="h" x="390" y="116">2) Epoch Bracketing + Interpolation</text>
  <text class="m" x="390" y="154">frac = (t − t<tspan baseline-shift="sub" font-size="18">0</tspan>)/(t<tspan baseline-shift="sub" font-size="18">1</tspan> − t<tspan baseline-shift="sub" font-size="18">0</tspan>)</text>
  <text class="m" x="390" y="190">g(t) = g<tspan baseline-shift="sub" font-size="18">0</tspan> + (g<tspan baseline-shift="sub" font-size="18">1</tspan> − g<tspan baseline-shift="sub" font-size="18">0</tspan>) frac</text>
  <text class="m" x="390" y="226">h(t) = h<tspan baseline-shift="sub" font-size="18">0</tspan> + (h<tspan baseline-shift="sub" font-size="18">1</tspan> − h<tspan baseline-shift="sub" font-size="18">0</tspan>) frac</text>
  <text class="m" x="390" y="262">ġ=(g<tspan baseline-shift="sub" font-size="18">1</tspan>−g<tspan baseline-shift="sub" font-size="18">0</tspan>)/(t<tspan baseline-shift="sub" font-size="18">1</tspan>−t<tspan baseline-shift="sub" font-size="18">0</tspan>)</text>

  <rect class="box" x="740" y="84" width="620" height="220" />
  <text class="h" x="760" y="116">3) Magnetic Scalar Potential (Spherical Harmonics)</text>
  <text class="m" x="760" y="156">V(r, θ, λ)=a Σ<tspan baseline-shift="super" font-size="18">N</tspan><tspan baseline-shift="sub" font-size="16">n=1</tspan>(a/r)<tspan baseline-shift="super" font-size="18">n+1</tspan></text>
  <text class="m" x="760" y="192">× Σ<tspan baseline-shift="super" font-size="18">n</tspan><tspan baseline-shift="sub" font-size="16">m=0</tspan>[g<tspan baseline-shift="sub" font-size="16">nm</tspan>cos(mλ)+h<tspan baseline-shift="sub" font-size="16">nm</tspan>sin(mλ)]</text>
  <text class="m" x="760" y="228">× P<tspan baseline-shift="sub" font-size="16">n,m</tspan>(cos θ)</text>
  <text class="t" x="760" y="264">Use interpolated g/h at time t.</text>

  <rect class="em" x="170" y="338" width="360" height="160" />
  <text class="h" x="190" y="370">4) Main Field Components</text>
  <text class="m" x="190" y="408">B = −∇V</text>
  <text class="m" x="190" y="446">X = B<tspan baseline-shift="sub" font-size="18">N</tspan>, Y = B<tspan baseline-shift="sub" font-size="18">E</tspan>, Z = B<tspan baseline-shift="sub" font-size="18">D</tspan></text>
  <text class="t" x="190" y="476">Computed via fieldComponents(nmax, g, h, ...)</text>

  <rect class="em" x="560" y="338" width="390" height="160" />
  <text class="h" x="580" y="370">5) Derived Quantities</text>
  <text class="m" x="580" y="408">H = √(X<tspan baseline-shift="super" font-size="18">2</tspan> + Y<tspan baseline-shift="super" font-size="18">2</tspan>)</text>
  <text class="m" x="580" y="442">F = √(H<tspan baseline-shift="super" font-size="18">2</tspan> + Z<tspan baseline-shift="super" font-size="18">2</tspan>)</text>
  <text class="m" x="580" y="476">D = atan2(Y, X), I = atan2(Z, H)</text>

  <rect class="box" x="980" y="338" width="380" height="190" />
  <text class="h" x="1000" y="370">6) Secular Variation (Per Year)</text>
  <text class="m" x="1000" y="408">(Ẋ, Ẏ, Ż) = fieldComponents(n<tspan baseline-shift="sub" font-size="18">max</tspan>, ġ, ḣ, ...)</text>
  <text class="m" x="1000" y="444">⇒ (Ḣ, Ḟ, Ḋ, İ)</text>

  <rect class="box" x="420" y="578" width="560" height="180" />
  <text class="h" x="442" y="610">7) Final Result Object</text>
  <text class="m" x="442" y="648">MagneticFieldSolution = {</text>
  <text class="m" x="442" y="684">  mainField: (X, Y, Z, H, F, D, I),</text>
  <text class="m" x="442" y="720">  secularVariation: (Ẋ, Ẏ, Ż, Ḣ, Ḟ, Ḋ, İ) }</text>

  <path class="line" d="M330 150 L370 150" marker-end="url(#arrow)" />
  <path class="line" d="M710 170 L740 170" marker-end="url(#arrow)" />
  <path class="line" d="M1050 304 L1050 322 L350 322 L350 338" marker-end="url(#arrow)" />
  <path class="line" d="M530 418 L560 418" marker-end="url(#arrow)" />
  <path class="line" d="M950 418 L980 418" marker-end="url(#arrow)" />
  <path class="line" d="M1170 528 L1170 560 L700 560 L700 578" marker-end="url(#arrow)" />
</svg>
